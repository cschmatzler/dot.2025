#!/usr/bin/env nu

print "üßπ Cleaning up packages and caches..."

# Brew cleanup
if (which brew | is-not-empty) {
    print "üç∫ Cleaning up brew packages..."
    
{{- if .personal | default false }}
    let brewfile_content = (open $"($env.HOME)/.config/brew/Brewfile.common" | str trim) + "\n" + (open $"($env.HOME)/.config/brew/Brewfile.personal" | str trim)
{{ else }}
    let brewfile_content = (open $"($env.HOME)/.config/brew/Brewfile.common" | str trim) + "\n" + (open $"($env.HOME)/.config/brew/Brewfile.work" | str trim)
{{- end }}
    
    $brewfile_content | brew bundle cleanup --force --file=-
    brew cleanup
    print "‚úÖ Brew cleanup complete"
} else {
    print "‚ö†Ô∏è  brew not found, skipping..."
}

# Mise cleanup
if (which mise | is-not-empty) {
    print "üîß Cleaning up mise caches..."
    mise cache clear
    mise prune
    print "‚úÖ Mise cleanup complete"
} else {
    print "‚ö†Ô∏è  mise not found, skipping..."
}

# Neovim plugin cleanup (if lazy.nvim is available)
if (which nvim | is-not-empty) {
    print "üîå Cleaning up neovim plugins..."
    try {
        nvim --headless "+Lazy! clean" +qa
    } catch {
        print "‚ÑπÔ∏è  No neovim plugins to clean"
    }
    print "‚úÖ Neovim cleanup complete"
} else {
    print "‚ö†Ô∏è  neovim not found, skipping..."
}

print "‚úÖ All cleanup complete!"