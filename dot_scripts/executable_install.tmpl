#!/usr/bin/env nu

print "ğŸ“¦ Installing packages..."

# Brew packages
if (which brew | is-not-empty) {
    print "ğŸº Installing brew packages..."
    brew update
    brew upgrade
    
{{- if .personal | default false }}
    let brewfile_content = (open $"($env.HOME)/.config/brew/Brewfile.common" | str trim) + "\n" + (open $"($env.HOME)/.config/brew/Brewfile.personal" | str trim)
{{ else }}
    let brewfile_content = (open $"($env.HOME)/.config/brew/Brewfile.common" | str trim) + "\n" + (open $"($env.HOME)/.config/brew/Brewfile.work" | str trim)
{{- end }}
    
    $brewfile_content | brew bundle --file=-
    brew upgrade --fetch-HEAD
    print "âœ… Brew packages installed"
} else {
    print "âš ï¸  brew not found, skipping..."
}

# Mise tools
if (which mise | is-not-empty) {
    print "ğŸ”§ Installing mise tools..."
    mise install
    print "âœ… Mise tools installed"
} else {
    print "âš ï¸  mise not found, skipping..."
}

print "âœ… All packages installed!"