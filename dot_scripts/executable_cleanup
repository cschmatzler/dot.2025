#!/usr/bin/env bash

set -e

echo "üßπ Cleaning up packages and caches..."

# Brew cleanup
if command -v brew &>/dev/null; then
  echo "üç∫ Cleaning up brew packages..."
  
{{- if .personal | default false }}
  cat $HOME/.config/brew/Brewfile.common $HOME/.config/brew/Brewfile.personal | brew bundle cleanup --force --file=-
{{ else }}
  cat $HOME/.config/brew/Brewfile.common $HOME/.config/brew/Brewfile.work | brew bundle cleanup --force --file=-
{{- end }}

  brew cleanup
  echo "‚úÖ Brew cleanup complete"
else
  echo "‚ö†Ô∏è  brew not found, skipping..."
fi

# Mise cleanup
if command -v mise &>/dev/null; then
  echo "üîß Cleaning up mise caches..."
  mise cache clear
  mise prune
  echo "‚úÖ Mise cleanup complete"
else
  echo "‚ö†Ô∏è  mise not found, skipping..."
fi

# Neovim plugin cleanup (if lazy.nvim is available)
if command -v nvim &>/dev/null; then
  echo "üîå Cleaning up neovim plugins..."
  nvim --headless "+Lazy! clean" +qa 2>/dev/null || echo "‚ÑπÔ∏è  No neovim plugins to clean"
  echo "‚úÖ Neovim cleanup complete"
else
  echo "‚ö†Ô∏è  neovim not found, skipping..."
fi

echo "‚úÖ All cleanup complete!"